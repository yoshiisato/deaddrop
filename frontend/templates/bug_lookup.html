{% extends 'base.html' %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="row g-4">
        <!-- Left margin: image -->
        <div class="col-md-4 text-center">
          <img src="{{ url_for('static', filename='images/find a bug.jpg') }}"
               alt="Find a Bug"
               class="img-fluid rounded shadow-sm"
               style="max-width: 100%;">
        </div>

        <!-- Main content: form and bug results -->
        <div class="col-md-8">
          <h2 class="mb-4">Obliviously Retrieve Report Decryption Key</h2>
          <form method="post" class="mb-4">
            <input type="hidden" name="form_type" value="detect_lookup">
            <div class="form-floating">
              <input type="text" class="form-control" id="pk_detect" name="pk_detect"
                    placeholder="Enter pk_detect" value="{{ pk_detect }}" required>
              <label for="pk_detect">pk_detect</label>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Search</button>
          </form>

          {% if tool_error %}
            <div class="alert alert-danger">
              {{ tool_error }}
            </div>
          {% endif %}

          {% if bugs %}
            {% if pk_detect == "*" %}
              <div class="alert alert-warning">
                Debug: Showing all bug reports (special pk_detect * entered)
              </div>
            {% endif %}
            <h5 class="mb-3">Bug Reports</h5>
            {% for bug in bugs %}
              <div class="card mb-3">
                <div class="card-body">
                  <p><strong>Ciphertext entry ID: {{ bug.bugid }}</strong></p>
                  <p><strong>Decryption Key: </strong> <code>{{ bug.ciphertext }}</code></p>
                  <p class="text-muted small">Reported: {{ bug.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                </div>
              </div>
            {% endfor %}
          {% elif pk_detect %}
            <div class="alert alert-warning">No bugs found for detection key <code>{{ pk_detect }}</code>.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}